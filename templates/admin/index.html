{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}
{{ block.super }}
<link rel="stylesheet" href="{% static "admin/css/dashboard.css" %}">
<style>
  .ops-badge {
    display: inline-block;
    padding: 2px 10px;
    border-radius: 999px;
    font-weight: 700;
    font-size: 12px;
    line-height: 1.4;
  }
  .ops-badge-ok {
    background: #e8f7ec;
    color: #156d2f;
    border: 1px solid #9bd7ab;
  }
  .ops-badge-warn {
    background: #fff3cd;
    color: #7a5200;
    border: 1px solid #f5cd79;
  }
  .ops-badge-danger {
    background: #fdecec;
    color: #8a1f1f;
    border: 1px solid #efaaaa;
  }
  .ops-error-text {
    margin-top: 6px;
    color: #8a1f1f;
    font-size: 12px;
    white-space: pre-wrap;
    word-break: break-word;
  }
</style>
{% endblock %}
{% block coltype %}colMS{% endblock %}
{% block bodyclass %}{{ block.super }} dashboard{% endblock %}
{% block nav-breadcrumbs %}{% endblock %}
{% block nav-sidebar %}{% endblock %}

{% block content %}
<div id="content-main">
  {% if admin_ops_summary %}
  <div class="module">
    <table>
      <caption>Operasyon Özeti</caption>
      <tbody>
        <tr>
          <th>Zamanlayıcı Durumu</th>
          <td>
            {% if admin_ops_summary.scheduler_healthy %}
              <span class="ops-badge ops-badge-ok">Sağlıklı</span>
            {% else %}
              <span class="ops-badge ops-badge-danger">Uyarı</span>
            {% endif %}
          </td>
        </tr>
        <tr>
          <th>Son Başarılı Çalışma</th>
          <td>{{ admin_ops_summary.scheduler_last_success_at|default:"-" }}</td>
        </tr>
        <tr>
          <th>Heartbeat Yaşı (sn)</th>
          <td>
            {% if admin_ops_summary.scheduler_age_seconds is not None %}
              {% if admin_ops_summary.scheduler_healthy %}
                <span class="ops-badge ops-badge-ok">{{ admin_ops_summary.scheduler_age_seconds }}</span>
              {% else %}
                <span class="ops-badge ops-badge-warn">{{ admin_ops_summary.scheduler_age_seconds }}</span>
              {% endif %}
            {% else %}
              -
            {% endif %}
          </td>
        </tr>
        <tr>
          <th>Son Hata</th>
          <td>
            {% if admin_ops_summary.scheduler_last_error %}
              <span class="ops-badge ops-badge-danger">Hata Var</span>
              <div class="ops-error-text">{{ admin_ops_summary.scheduler_last_error }}</div>
            {% else %}
              <span class="ops-badge ops-badge-ok">Hata Yok</span>
            {% endif %}
          </td>
        </tr>
        <tr>
          <th>Son 1 Saat Olay</th>
          <td>{{ admin_ops_summary.events_last_hour }}</td>
        </tr>
        <tr>
          <th>Açık Talep</th>
          <td>{{ admin_ops_summary.open_requests }}</td>
        </tr>
        <tr>
          <th>Bekleyen Randevu</th>
          <td>{{ admin_ops_summary.open_appointments }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  {% endif %}

  {% include "admin/app_list.html" with app_list=app_list show_changelinks=True %}
</div>
{% endblock %}

{% block sidebar %}
<div id="content-related">
  <div class="module" id="recent-actions-module">
    <h2>{% translate 'Recent actions' %}</h2>
    <h3>{% translate 'My actions' %}</h3>
    {% load log %}
    {% get_admin_log 10 as admin_log for_user user %}
    {% if not admin_log %}
    <p>{% translate 'None available' %}</p>
    {% else %}
    <ul class="actionlist">
      {% for entry in admin_log %}
      <li class="{% if entry.is_addition %}addlink{% elif entry.is_change %}changelink{% elif entry.is_deletion %}deletelink{% endif %}">
        <span class="visually-hidden">{% if entry.is_addition %}{% translate 'Added:' %}{% elif entry.is_change %}{% translate 'Changed:' %}{% elif entry.is_deletion %}{% translate 'Deleted:' %}{% endif %}</span>
        {% if entry.is_deletion or not entry.get_admin_url %}
          {{ entry.object_repr }}
        {% else %}
          <a href="{{ entry.get_admin_url }}">{{ entry.object_repr }}</a>
        {% endif %}
        <br>
        {% if entry.content_type %}
          <span class="mini quiet">{% filter capfirst %}{{ entry.content_type.name }}{% endfilter %}</span>
        {% else %}
          <span class="mini quiet">{% translate 'Unknown content' %}</span>
        {% endif %}
      </li>
      {% endfor %}
    </ul>
    {% endif %}
  </div>
</div>
{% endblock %}
